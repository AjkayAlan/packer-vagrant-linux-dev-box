{
    "variables": {
        "BASE_BOX_NAME": "{{env `BASE_BOX_NAME`}}",
        "SSH_USERNAME": "{{env `SSH_USERNAME`}}",
        "SSH_PASSWORD": "{{env `SSH_PASSWORD`}}",
        "OUTPUT_BOX_NAME": "{{env `OUTPUT_BOX_NAME`}}"
    },
    "builders": [
        {
            "type": "vagrant",
            "provider": "hyperv",
            "communicator": "ssh",
            "ssh_username": "{{user `SSH_USERNAME`}}",
            "ssh_password": "{{user `SSH_PASSWORD`}}",
            "source_path": "{{user `BASE_BOX_NAME`}}",
            "box_name": "{{user `BASE_BOX_NAME`}}",
            "template": "./vagrant-ubuntu1804-hyperv-template.go",
            "add_force": true
        }
    ],
    "provisioners": [
        {
            "type": "shell",
            "scripts": [
                "./provision/update-box.sh",
                "./provision/install-basics.sh",
                "./provision/install-git.sh",
                "./provision/install-zsh.sh",
                "./provision/install-desktop.sh"
            ]
        },
        {
            "type": "shell",
            "script": "./provision/reboot.sh",
            "expect_disconnect": true
        },
        {
            "type": "shell",
            "scripts": [
                "./provision/install-xrdp.sh",
                "./provision/install-chromium.sh",
                "./provision/install-nvm-node.sh",
                "./provision/install-pyenv-python.sh",
                "./provision/install-gvm-go.sh",
                "./provision/install-rvm-ruby.sh",
                "./provision/install-sdkman.sh",
                "./provision/install-jabba-java.sh",
                "./provision/install-netcore.sh",
                "./provision/install-powershell-core.sh",
                "./provision/install-awscli.sh",
                "./provision/install-vscode.sh",
                "./provision/install-pycharm.sh",
                "./provision/install-intellij.sh",
                "./provision/install-terminus.sh",
                "./provision/fix-grub-timeout.sh"
            ]
        }
    ],
    "post-processors": [
        {
            "type": "shell-local",
            "tempfile_extension": ".ps1",
            "environment_vars": ["OUTPUT_BOX_NAME={{user `OUTPUT_BOX_NAME`}}"],
            "execute_command": ["powershell.exe", "{{.Vars}} {{.Script}}"],
            "env_var_format": "$env:%s=\"%s\"; ",
            "inline": ["Rename-Item -Path '.\\output-vagrant\\package.box' -NewName $($env:OUTPUT_BOX_NAME).box"]
        }
    ]
}